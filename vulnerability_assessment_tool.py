import time
from zapv2 import ZAPv2

api_key = 'your_zap_api_key'
target_url = 'http://example.com'

zap = ZAPv2(apikey=api_key)

# Start the ZAP session
zap.core.new_session(name='vulnerability_assessment', overwrite=True)

# Spider the target
print('Spidering target {}'.format(target_url))
zap.spider.scan(target_url)
time.sleep(5)

while (int(zap.spider.status()) < 100):
    print('Spider progress %: {}'.format(zap.spider.status()))
    time.sleep(2)
print('Spider completed')

# Perform an active scan
print('Scanning target {}'.format(target_url))
zap.ascan.scan(target_url)
while (int(zap.ascan.status()) < 100):
    print('Scan progress %: {}'.format(zap.ascan.status()))
    time.sleep(5)
print('Scan completed')

# Get the results
alerts = zap.core.alerts()
print('Alerts: {}'.format(alerts))

# Save the results to a file
with open('vulnerability_report.json', 'w') as f:
    json.dump(alerts, f, indent=4)
